/*
-----------------------------------------------------------------------------
Filename:    TutorialApplication.cpp
-----------------------------------------------------------------------------

This source file is part of the
   ___                 __    __ _ _    _
  /___\__ _ _ __ ___  / / /\ \ (_) | _(_)
 //  // _` | '__/ _ \ \ \/  \/ / | |/ / |
/ \_// (_| | | |  __/  \  /\  /| |   <| |
\___/ \__, |_|  \___|   \/  \/ |_|_|\_\_|
      |___/
      Tutorial Framework
      http://www.ogre3d.org/tikiwiki/
-----------------------------------------------------------------------------
*/
#include "TutorialApplication.h"
#include <cstdio>

static Ogre::Vector3 g_locations[160] = {
    Ogre::Vector3(0.9067535400390625, 0.0, -5.594421863555908),
	Ogre::Vector3(4.487725257873535, -3.6291096210479736, -5.594421863555908),
	Ogre::Vector3(7.536551475524902, 4.60202169418335, -5.594421863555908),
	Ogre::Vector3(4.195628643035889, 4.084336280822754, -5.594421863555908),
	Ogre::Vector3(1.0659408569335938, 4.5403547286987305, -5.594421863555908),
	Ogre::Vector3(8.566661834716797, 0.0, -5.594421863555908),
	Ogre::Vector3(4.195628643035889, 0.0, -5.594421863555908),
	Ogre::Vector3(1.3287179470062256, -3.5318453311920166, -5.594421863555908),
	Ogre::Vector3(7.559786319732666, -3.7543468475341797, -5.594421863555908),
	Ogre::Vector3(-1.537890911102295, 0.0, -5.594421863555908),
	Ogre::Vector3(-1.6331596374511719, 4.090501308441162, -5.594421863555908),
	Ogre::Vector3(-1.6331596374511719, 6.556361675262451, -5.594421863555908),
	Ogre::Vector3(1.0659408569335938, 7.0062150955200195, -5.594421863555908),
	Ogre::Vector3(4.195628643035889, 6.550196647644043, -5.594421863555908),
	Ogre::Vector3(7.536551475524902, 7.067882061004639, -5.594421863555908),
	Ogre::Vector3(7.536551475524902, 10.051143646240234, -5.594421863555908),
	Ogre::Vector3(4.195628643035889, 9.53345775604248, -5.594421863555908),
	Ogre::Vector3(1.0659408569335938, 9.989476203918457, -5.594421863555908),
	Ogre::Vector3(-1.6331596374511719, 9.539623260498047, -5.594421863555908),
	Ogre::Vector3(-1.6331596374511719, 9.539623260498047, -1.9626548290252686),
	Ogre::Vector3(1.0659408569335938, 9.989476203918457, -1.9626548290252686),
	Ogre::Vector3(4.195628643035889, 9.53345775604248, -1.9626548290252686),
	Ogre::Vector3(7.536551475524902, 10.051143646240234, -1.9626548290252686),
	Ogre::Vector3(7.536551475524902, 7.067882061004639, -1.9626548290252686),
	Ogre::Vector3(4.195628643035889, 6.550196647644043, -1.9626548290252686),
	Ogre::Vector3(1.0659408569335938, 7.0062150955200195, -1.9626548290252686),
	Ogre::Vector3(-1.6331596374511719, 6.556361675262451, -1.9626548290252686),
	Ogre::Vector3(-1.6331596374511719, 4.090501308441162, -1.9626548290252686),
	Ogre::Vector3(-1.537890911102295, 0.0, -1.9626548290252686),
	Ogre::Vector3(7.559786319732666, -3.7543468475341797, -1.9626548290252686),
	Ogre::Vector3(1.3287179470062256, -3.5318453311920166, -1.9626548290252686),
	Ogre::Vector3(4.195628643035889, 0.0, -1.9626548290252686),
	Ogre::Vector3(8.566661834716797, 0.0, -1.9626548290252686),
	Ogre::Vector3(1.0659408569335938, 4.5403547286987305, -1.9626548290252686),
	Ogre::Vector3(4.195628643035889, 4.084336280822754, -1.9626548290252686),
	Ogre::Vector3(7.536551475524902, 4.60202169418335, -1.9626548290252686),
	Ogre::Vector3(4.487725257873535, -3.6291096210479736, -1.9626548290252686),
	Ogre::Vector3(0.9067535400390625, 0.0, -1.9626548290252686),
	Ogre::Vector3(-1.1706252098083496, -3.056563138961792, -1.9626548290252686),
	Ogre::Vector3(-1.1706252098083496, -3.056563138961792, -5.594421863555908),
	Ogre::Vector3(-1.1706252098083496, -3.056563138961792, 2.0890488624572754),
	Ogre::Vector3(-1.1706252098083496, -3.056563138961792, 5.720815658569336),
	Ogre::Vector3(0.9067535400390625, 0.0, 5.720815658569336),
	Ogre::Vector3(4.487725257873535, -3.6291096210479736, 5.720815658569336),
	Ogre::Vector3(7.536551475524902, 4.60202169418335, 5.720815658569336),
	Ogre::Vector3(4.195628643035889, 4.084336280822754, 5.720815658569336),
	Ogre::Vector3(1.0659408569335938, 4.5403547286987305, 5.720815658569336),
	Ogre::Vector3(8.566661834716797, 0.0, 5.720815658569336),
	Ogre::Vector3(4.195628643035889, 0.0, 5.720815658569336),
	Ogre::Vector3(1.3287179470062256, -3.5318453311920166, 5.720815658569336),
	Ogre::Vector3(7.559786319732666, -3.7543468475341797, 5.720815658569336),
	Ogre::Vector3(-1.537890911102295, 0.0, 5.720815658569336),
	Ogre::Vector3(-1.6331596374511719, 4.090501308441162, 5.720815658569336),
	Ogre::Vector3(-1.6331596374511719, 6.556361675262451, 5.720815658569336),
	Ogre::Vector3(1.0659408569335938, 7.0062150955200195, 5.720815658569336),
	Ogre::Vector3(4.195628643035889, 6.550196647644043, 5.720815658569336),
	Ogre::Vector3(7.536551475524902, 7.067882061004639, 5.720815658569336),
	Ogre::Vector3(7.536551475524902, 10.051143646240234, 5.720815658569336),
	Ogre::Vector3(4.195628643035889, 9.53345775604248, 5.720815658569336),
	Ogre::Vector3(1.0659408569335938, 9.989476203918457, 5.720815658569336),
	Ogre::Vector3(-1.6331596374511719, 9.539623260498047, 5.720815658569336),
	Ogre::Vector3(-1.6331596374511719, 9.539623260498047, 2.0890488624572754),
	Ogre::Vector3(1.0659408569335938, 9.989476203918457, 2.0890488624572754),
	Ogre::Vector3(4.195628643035889, 9.53345775604248, 2.0890488624572754),
	Ogre::Vector3(7.536551475524902, 10.051143646240234, 2.0890488624572754),
	Ogre::Vector3(7.536551475524902, 7.067882061004639, 2.0890488624572754),
	Ogre::Vector3(4.195628643035889, 6.550196647644043, 2.0890488624572754),
	Ogre::Vector3(1.0659408569335938, 7.0062150955200195, 2.0890488624572754),
	Ogre::Vector3(-1.6331596374511719, 6.556361675262451, 2.0890488624572754),
	Ogre::Vector3(-1.6331596374511719, 4.090501308441162, 2.0890488624572754),
	Ogre::Vector3(-1.537890911102295, 0.0, 2.0890488624572754),
	Ogre::Vector3(7.559786319732666, -3.7543468475341797, 2.0890488624572754),
	Ogre::Vector3(1.3287179470062256, -3.5318453311920166, 2.0890488624572754),
	Ogre::Vector3(4.195628643035889, 0.0, 2.0890488624572754),
	Ogre::Vector3(8.566661834716797, 0.0, 2.0890488624572754),
	Ogre::Vector3(1.0659408569335938, 4.5403547286987305, 2.0890488624572754),
	Ogre::Vector3(4.195628643035889, 4.084336280822754, 2.0890488624572754),
	Ogre::Vector3(7.536551475524902, 4.60202169418335, 2.0890488624572754),
	Ogre::Vector3(4.487725257873535, -3.6291096210479736, 2.0890488624572754),
	Ogre::Vector3(0.9067535400390625, 0.0, 2.0890488624572754),
	Ogre::Vector3(-10.22289752960205, 0.0, 2.0890488624572754),
	Ogre::Vector3(-6.641925811767578, -3.6291096210479736, 2.0890488624572754),
	Ogre::Vector3(-3.593099594116211, 4.60202169418335, 2.0890488624572754),
	Ogre::Vector3(-6.934022426605225, 4.084336280822754, 2.0890488624572754),
	Ogre::Vector3(-10.06371021270752, 4.5403547286987305, 2.0890488624572754),
	Ogre::Vector3(-2.5629892349243164, 0.0, 2.0890488624572754),
	Ogre::Vector3(-6.934022426605225, 0.0, 2.0890488624572754),
	Ogre::Vector3(-9.800932884216309, -3.5318453311920166, 2.0890488624572754),
	Ogre::Vector3(-3.5698647499084473, -3.7543468475341797, 2.0890488624572754),
	Ogre::Vector3(-12.66754150390625, 0.0, 2.0890488624572754),
	Ogre::Vector3(-12.762810707092285, 4.090501308441162, 2.0890488624572754),
	Ogre::Vector3(-12.762810707092285, 6.556361675262451, 2.0890488624572754),
	Ogre::Vector3(-10.06371021270752, 7.0062150955200195, 2.0890488624572754),
	Ogre::Vector3(-6.934022426605225, 6.550196647644043, 2.0890488624572754),
	Ogre::Vector3(-3.593099594116211, 7.067882061004639, 2.0890488624572754),
	Ogre::Vector3(-3.593099594116211, 10.051143646240234, 2.0890488624572754),
	Ogre::Vector3(-6.934022426605225, 9.53345775604248, 2.0890488624572754),
	Ogre::Vector3(-10.06371021270752, 9.989476203918457, 2.0890488624572754),
	Ogre::Vector3(-12.762810707092285, 9.539623260498047, 2.0890488624572754),
	Ogre::Vector3(-12.762810707092285, 9.539623260498047, 5.720815658569336),
	Ogre::Vector3(-10.06371021270752, 9.989476203918457, 5.720815658569336),
	Ogre::Vector3(-6.934022426605225, 9.53345775604248, 5.720815658569336),
	Ogre::Vector3(-3.593099594116211, 10.051143646240234, 5.720815658569336),
	Ogre::Vector3(-3.593099594116211, 7.067882061004639, 5.720815658569336),
	Ogre::Vector3(-6.934022426605225, 6.550196647644043, 5.720815658569336),
	Ogre::Vector3(-10.06371021270752, 7.0062150955200195, 5.720815658569336),
	Ogre::Vector3(-12.762810707092285, 6.556361675262451, 5.720815658569336),
	Ogre::Vector3(-12.762810707092285, 4.090501308441162, 5.720815658569336),
	Ogre::Vector3(-12.66754150390625, 0.0, 5.720815658569336),
	Ogre::Vector3(-3.5698647499084473, -3.7543468475341797, 5.720815658569336),
	Ogre::Vector3(-9.800932884216309, -3.5318453311920166, 5.720815658569336),
	Ogre::Vector3(-6.934022426605225, 0.0, 5.720815658569336),
	Ogre::Vector3(-2.5629892349243164, 0.0, 5.720815658569336),
	Ogre::Vector3(-10.06371021270752, 4.5403547286987305, 5.720815658569336),
	Ogre::Vector3(-6.934022426605225, 4.084336280822754, 5.720815658569336),
	Ogre::Vector3(-3.593099594116211, 4.60202169418335, 5.720815658569336),
	Ogre::Vector3(-6.641925811767578, -3.6291096210479736, 5.720815658569336),
	Ogre::Vector3(-10.22289752960205, 0.0, 5.720815658569336),
	Ogre::Vector3(-12.300275802612305, -3.056563138961792, 5.720815658569336),
	Ogre::Vector3(-12.300275802612305, -3.056563138961792, 2.0890488624572754),
	Ogre::Vector3(-12.300275802612305, -3.056563138961792, -5.594421863555908),
	Ogre::Vector3(-12.300275802612305, -3.056563138961792, -1.9626548290252686),
	Ogre::Vector3(-10.22289752960205, 0.0, -1.9626548290252686),
	Ogre::Vector3(-6.641925811767578, -3.6291096210479736, -1.9626548290252686),
	Ogre::Vector3(-3.593099594116211, 4.60202169418335, -1.9626548290252686),
	Ogre::Vector3(-6.934022426605225, 4.084336280822754, -1.9626548290252686),
	Ogre::Vector3(-10.06371021270752, 4.5403547286987305, -1.9626548290252686),
	Ogre::Vector3(-2.5629892349243164, 0.0, -1.9626548290252686),
	Ogre::Vector3(-6.934022426605225, 0.0, -1.9626548290252686),
	Ogre::Vector3(-9.800932884216309, -3.5318453311920166, -1.9626548290252686),
	Ogre::Vector3(-3.5698647499084473, -3.7543468475341797, -1.9626548290252686),
	Ogre::Vector3(-12.66754150390625, 0.0, -1.9626548290252686),
	Ogre::Vector3(-12.762810707092285, 4.090501308441162, -1.9626548290252686),
	Ogre::Vector3(-12.762810707092285, 6.556361675262451, -1.9626548290252686),
	Ogre::Vector3(-10.06371021270752, 7.0062150955200195, -1.9626548290252686),
	Ogre::Vector3(-6.934022426605225, 6.550196647644043, -1.9626548290252686),
	Ogre::Vector3(-3.593099594116211, 7.067882061004639, -1.9626548290252686),
	Ogre::Vector3(-3.593099594116211, 10.051143646240234, -1.9626548290252686),
	Ogre::Vector3(-6.934022426605225, 9.53345775604248, -1.9626548290252686),
	Ogre::Vector3(-10.06371021270752, 9.989476203918457, -1.9626548290252686),
	Ogre::Vector3(-12.762810707092285, 9.539623260498047, -1.9626548290252686),
	Ogre::Vector3(-12.762810707092285, 9.539623260498047, -5.594421863555908),
	Ogre::Vector3(-10.06371021270752, 9.989476203918457, -5.594421863555908),
	Ogre::Vector3(-6.934022426605225, 9.53345775604248, -5.594421863555908),
	Ogre::Vector3(-3.593099594116211, 10.051143646240234, -5.594421863555908),
	Ogre::Vector3(-3.593099594116211, 7.067882061004639, -5.594421863555908),
	Ogre::Vector3(-6.934022426605225, 6.550196647644043, -5.594421863555908),
	Ogre::Vector3(-10.06371021270752, 7.0062150955200195, -5.594421863555908),
	Ogre::Vector3(-12.762810707092285, 6.556361675262451, -5.594421863555908),
	Ogre::Vector3(-12.762810707092285, 4.090501308441162, -5.594421863555908),
	Ogre::Vector3(-12.66754150390625, 0.0, -5.594421863555908),
	Ogre::Vector3(-3.5698647499084473, -3.7543468475341797, -5.594421863555908),
	Ogre::Vector3(-9.800932884216309, -3.5318453311920166, -5.594421863555908),
	Ogre::Vector3(-6.934022426605225, 0.0, -5.594421863555908),
	Ogre::Vector3(-2.5629892349243164, 0.0, -5.594421863555908),
	Ogre::Vector3(-10.06371021270752, 4.5403547286987305, -5.594421863555908),
	Ogre::Vector3(-6.934022426605225, 4.084336280822754, -5.594421863555908),
	Ogre::Vector3(-3.593099594116211, 4.60202169418335, -5.594421863555908),
	Ogre::Vector3(-6.641925811767578, -3.6291096210479736, -5.594421863555908),
	Ogre::Vector3(-10.22289752960205, 0.0, -5.594421863555908)
};

static Ogre::Entity *g_entities[160] = {NULL};
static Ogre::SceneNode *g_nodes[160] = {NULL};

const static int NUM_CHARS = 70;


//-------------------------------------------------------------------------------------
TutorialApplication::TutorialApplication(void)
{
}
//-------------------------------------------------------------------------------------
TutorialApplication::~TutorialApplication(void)
{
}

//-------------------------------------------------------------------------------------
void TutorialApplication::createScene(void)
{
	mSceneMgr->setAmbientLight(Ogre::ColourValue(0.5f, 0.5f, 0.5f));

	Ogre::AnimationState *anim_state;

	for (int i = 0; i < NUM_CHARS; ++i) {
		char buff[10];
		sprintf(buff, "Ogre%d", i);
		g_entities[i] = mSceneMgr->createEntity(buff, "Sinbad.mesh");

		sprintf(buff, "OgreNode%d", i);
		g_nodes[i] = mSceneMgr->getRootSceneNode()->createChildSceneNode(buff,
															g_locations[i]*2.f);
		g_nodes[i]->attachObject(g_entities[i]);

		anim_state = g_entities[i]->getAnimationState("Dance");
		anim_state->setLoop(true);
		anim_state->setEnabled(true);
	}

	Ogre::Light* light = mSceneMgr->createLight("MainLight");
	light->setPosition(20.f, 80.f, 50.f);
}

bool TutorialApplication::frameRenderingQueued(const Ogre::FrameEvent &evt)
{
	bool ret = BaseApplication::frameRenderingQueued(evt);

	Ogre::AnimationState *anim_state;
	for (int i = 0; i < NUM_CHARS; ++i) {
		anim_state = g_entities[i]->getAnimationState("Dance");
		anim_state->addTime(evt.timeSinceLastFrame);
	}

	return ret;
}

#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
#define WIN32_LEAN_AND_MEAN
#include "windows.h"
#endif

#ifdef __cplusplus
extern "C" {
#endif

#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
    INT WINAPI WinMain( HINSTANCE hInst, HINSTANCE, LPSTR strCmdLine, INT )
#else
    int main(int argc, char *argv[])
#endif
    {
        // Create application object
        TutorialApplication app;

        try {
            app.go();
        } catch( Ogre::Exception& e ) {
#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
            MessageBox( NULL, e.getFullDescription().c_str(),
						"An exception has occured!",
						MB_OK | MB_ICONERROR | MB_TASKMODAL);
#else
            std::cerr << "An exception has occured: " <<
                e.getFullDescription().c_str() << std::endl;
#endif
        }

        return 0;
    }

#ifdef __cplusplus
}
#endif
